{
  "name" : "NextGenPSD2 Assets OpenAM Token Route",
  "baseURI" : "https://login.psd2accelerators.fridam.aeet-forgerock.com",
  "condition" : "${matches(request.uri.path, '^/oauth2/realms/root/realms/nextgenpsd2/access_token')}",
  "capture" : [ "response", "request" ],
  "heap" : [ {
    "name" : "ReverseProxyHandler",
    "type" : "ReverseProxyHandler",
    "capture" : [ "response", "request" ]
  }, {
    "name" : "capture",
    "type" : "CaptureDecorator",
    "config" : {
      "captureEntity" : true,
      "captureContext" : true
    }
  }, {
    "name" : "ForgeRockClientHandler",
    "type" : "Chain",
    "config" : {
      "filters" : [ "TransactionIdOutboundFilter" ],
      "handler" : "ClientHandler"
    },
    "capture" : [ "response", "request" ]
  } ],
  "handler" : {
    "type" : "Chain",
    "config" : {
      "filters" : [{
        "name" : "AssignmentFilter-Encode-SSL-Header",
        "type" : "AssignmentFilter",
        "config" : {
            "target" : "${attributes.sslHeader}",
            "value" : "${encodeBase64(urlDecode(toString(request.headers['ssl-client-cert'][0])))}"
          }
      	},
	{
        "name" : "HeaderFilter-Rewrite-Host",
        "type" : "HeaderFilter",
        "config" : {
          "messageType" : "REQUEST",
          "remove" : [ "host", "x-forwarded-host" ],
          "add" : {
            "host" : [ "login.psd2accelerators.fridam.aeet-forgerock.com" ],
            "x-forwarded-host" : [ "login.psd2accelerators.fridam.aeet-forgerock.com" ],
	    "ssl-am-client-cert" : [ "${encodeBase64(urlDecode(toString(request.headers['ssl-client-cert'][0])))}" ]
           }
	 }
        },
	{
        "name" : "HeaderFilter-Remove-Header",
        "type" : "HeaderFilter",
        "config" : {
          "messageType" : "REQUEST",
          "remove" : [ "ssl-client-cert" ]
         }
      } ],
      "handler" : "ReverseProxyHandler"
    }
  }
}