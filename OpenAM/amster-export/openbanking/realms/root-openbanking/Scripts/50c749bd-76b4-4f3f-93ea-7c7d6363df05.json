{
  "metadata" : {
    "realm" : "/openbanking",
    "amsterVersion" : "6.5.0",
    "entityType" : "Scripts",
    "entityId" : "50c749bd-76b4-4f3f-93ea-7c7d6363df05",
    "pathParams" : { }
  },
  "data" : {
    "_id" : "50c749bd-76b4-4f3f-93ea-7c7d6363df05",
    "name" : "Scripted Policy Condition - PISP",
    "description" : null,
    "script" : "LyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogKiAgQ29weXJpZ2h0IDIwMTkgRm9yZ2VSb2NrIEFTLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogKiAgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAqICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCnZhciBpbnRlbnRJZDsKdmFyIHBheW1lbnRBbW91bnQ7CnZhciBwYXltZW50Q3VycmVuY3kKCmlmICh2YWxpZGF0ZUFuZEluaXRpYWxpemVQYXJhbWV0ZXJzKCkpIHsKCiAgICB2YXIgY29uc2VudERldGFpbHMgPSBnZXRDb25zZW50RGV0YWlsc0Zyb21JRE0oaW50ZW50SWQpOwoJCiAgICBsb2dnZXIubWVzc2FnZSgiUGF5bWVudCBDb25zZW50IERldGFpbHMgcmV0cmlldmVkIGZyb20gSURNOiAiICsgY29uc2VudERldGFpbHMpOwogICAgCiAgICBpZiAoY29uc2VudERldGFpbHMgIT0gbnVsbCkgewoJCXZhciBwZXJtaXNzaW9uc0pzb25SZXNwb25zZTsKCQl2YXIganNvblJlc3BvbnNlID0gSlNPTi5wYXJzZShjb25zZW50RGV0YWlscy5nZXRFbnRpdHkoKSk7CgkJdmFyIGRhdGFKc29uUmVzcG9uc2UgPSBqc29uUmVzcG9uc2UuRGF0YTsKCQlpZiAoZGF0YUpzb25SZXNwb25zZSAhPSBudWxsKSB7CgkJCS8vbG9nZ2VyLm1lc3NhZ2UoIltERUJVR10gUGVybWlzc2lvbnM6ICIgKyBkYXRhSnNvblJlc3BvbnNlLlBlcm1pc3Npb25zKTsKCQkJLy9wZXJtaXNzaW9uc0pzb25SZXNwb25zZSA9IGRhdGFKc29uUmVzcG9uc2UuUGVybWlzc2lvbnM7CgkJCS8qCgkJCXZhciBpOwoJCQlmb3IgKGkgPSAwOyBpIDwgcGVybWlzc2lvbnNKc29uUmVzcG9uc2UubGVuZ3RoOyBpKyspIHsKCQkJCXZhciByZXN1bHQgPSBwZXJtaXNzaW9uc0pzb25SZXNwb25zZVtpXTsKCQkJCWxvZ2dlci5tZXNzYWdlKCJbREVCVUddIHJlc3VsdDogIiArIHJlc3VsdCk7CgkJCQkKCQkJCWlmIChyZXN1bHQuZXF1YWxzSWdub3JlQ2FzZShjdXJyZW50UGVybWlzc2lvbikpewoJCQkJCWxvZ2dlci5tZXNzYWdlKCJbREVCVUddIEF1dGhvcml6YXRpb24gU3VjY2VlZGVkIik7CgkJCQkJLy9yZXNwb25zZUF0dHJpYnV0ZXMucHV0KCJjb25zZW50RGV0YWlscyIsIFtjb25zZW50RGV0YWlsc10pOwoJCQkJCWF1dGhvcml6ZWQgPSB0cnVlOwoJCQkJfQoJCQl9CgkJCSovCgkJCWF1dGhvcml6ZWQgPSB0cnVlOwoJCX0KICAgIH0gZWxzZSB7CiAgICAgICAgbG9nZ2VyLm1lc3NhZ2UoIkF1dGhvcml6YXRpb24gRmFpbGVkIik7CiAgICAgICAgYXV0aG9yaXplZCA9IGZhbHNlOwogICAgfQoKfSBlbHNlIHsKICAgIGxvZ2dlci5tZXNzYWdlKCJSZXF1aXJlZCBwYXJhbWV0ZXJzIG5vdCBmb3VuZC4gQXV0aG9yaXphdGlvbiBGYWlsZWQuIik7CiAgICBhdXRob3JpemVkID0gZmFsc2U7Cn0KCi8qKgogKiBVc2UgdGhlIGludGVudElkJ3MgdmFsdWUgdG8gbG9va3VwIHRoZSBjb25zZW50IGRldGFpbHMgaW4gSURNLgogKgogKiBAcmV0dXJucyB7Kn0gVGhlIHVzZXIncyBjb25zZW50IGRldGFpbHMgZnJvbSBJRE0uCiAqLwpmdW5jdGlvbiBnZXRDb25zZW50RGV0YWlsc0Zyb21JRE0oaW50ZW50SWQpIHsKIAogICAgdmFyIHJlcXVlc3QgPSBuZXcgb3JnLmZvcmdlcm9jay5odHRwLnByb3RvY29sLlJlcXVlc3QoKTsKICAgIHJlcXVlc3Quc2V0VXJpKCJodHRwczovL29wZW5pZG0ucHNkMmFjY2VsZXJhdG9ycy5mcmlkYW0uYWVldC1mb3JnZXJvY2suY29tL29wZW5pZG0vbWFuYWdlZC9PQlBheW1lbnRJbnRlbnQvIiArIGludGVudElkKTsKICAgIHJlcXVlc3QuZ2V0SGVhZGVycygpLmFkZCgnWC1PcGVuSURNLVVzZXJuYW1lJywgJ29wZW5pZG0tYWRtaW4nKTsKCXJlcXVlc3QuZ2V0SGVhZGVycygpLmFkZCgnWC1PcGVuSURNLVBhc3N3b3JkJywgJ29wZW5pZG0tYWRtaW4nKTsKICAJcmVxdWVzdC5zZXRNZXRob2QoIkdFVCIpOwoKICAgIHZhciByZXNwb25zZSA9IGh0dHBDbGllbnQuc2VuZChyZXF1ZXN0KS5nZXQoKTsKICAgIGxvZ1Jlc3BvbnNlKHJlc3BvbnNlKTsKCglyZXR1cm4gcmVzcG9uc2U7Cn0KCi8qKgogKiBSZXRyaWV2ZSBhbmQgdmFsaWRhdGUgdGhlIHZhcmlhYmxlcyByZXF1aXJlZCB0byBtYWtlIHRoZSBleHRlcm5hbCBIVFRQIGNhbGxzLgogKgogKiBAcmV0dXJucyB7Ym9vbGVhbn0gV2lsbCBiZSB0cnVlIGlmIHZhbGlkYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAqLwpmdW5jdGlvbiB2YWxpZGF0ZUFuZEluaXRpYWxpemVQYXJhbWV0ZXJzKCkgewogICAgLy9UTVAgLSB0byBiZSByZXBsYWNlZAoJLy8gdGhlIGludGVudElkIGFuZCBjdXJyZW50UGVybWlzc2lvbiBzaG91bGQgYmUgZ2V0IGR5bmFtaWNhbGx5Li4uCglpbnRlbnRJZCA9ICJlYzE3NDcxMC0zNWY3LTQ4NDYtYTQ1OS1kMWM2ZDJhM2EwNDAiOwoJcGF5bWVudEFtb3VudCA9ICIyOTkuOTkiOwoJcGF5bWVudEN1cnJlbmN5ID0gIkdCUCI7CgkKICAgIGxvZ2dlci5tZXNzYWdlKCJbREVCVUddIElucHV0IEludGVudElkOiAiICsgaW50ZW50SWQpOwoJbG9nZ2VyLm1lc3NhZ2UoIltERUJVR10gSW5wdXQgUGF5bWVudCBBbW91bnQgZnJvbSBTdWJtaXNzaW9uIHJlcXVlc3Q6ICIgKyBwYXltZW50QW1vdW50KTsKCWxvZ2dlci5tZXNzYWdlKCJbREVCVUddIElucHV0IFBheW1lbnQgQ3VycmVuY3kgZnJvbSBTdWJtaXNzaW9uIHJlcXVlc3Q6ICIgKyBwYXltZW50Q3VycmVuY3kpOwoJCiAgICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gbG9nUmVzcG9uc2UocmVzcG9uc2UpIHsKICAgIGxvZ2dlci5tZXNzYWdlKCJbREVCVUddIFVzZXIgUkVTVCBDYWxsLiBTdGF0dXM6ICIgKyByZXNwb25zZS5nZXRTdGF0dXMoKSArICIsIEJvZHk6ICIgKyByZXNwb25zZS5nZXRFbnRpdHkoKSk7Cn0=",
    "default" : false,
    "language" : "JAVASCRIPT",
    "context" : "POLICY_CONDITION",
    "createdBy" : "null",
    "creationDate" : 0,
    "lastModifiedBy" : "null",
    "lastModifiedDate" : 0
  }
}