{
  "metadata" : {
    "realm" : "/openbanking",
    "amsterVersion" : "6.5.0",
    "entityType" : "Scripts",
    "entityId" : "ac7b331e-acea-4f67-9ec7-ed59f092243a",
    "pathParams" : { }
  },
  "data" : {
    "_id" : "ac7b331e-acea-4f67-9ec7-ed59f092243a",
    "name" : "Scripted Policy Condition - AISP",
    "description" : null,
    "script" : "LyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogKiAgQ29weXJpZ2h0IDIwMTkgRm9yZ2VSb2NrIEFTLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogKiAgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAqICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCnZhciBpbnRlbnRJZDsKdmFyIGN1cnJlbnRQZXJtaXNzaW9uOwoKaWYgKHZhbGlkYXRlQW5kSW5pdGlhbGl6ZVBhcmFtZXRlcnMoKSkgewoKICAgIHZhciBjb25zZW50RGV0YWlscyA9IGdldENvbnNlbnREZXRhaWxzRnJvbUlETShpbnRlbnRJZCk7CgkKICAgIGxvZ2dlci5tZXNzYWdlKCJDb25zZW50IERldGFpbHMgcmV0cmlldmVkIGZyb20gSURNOiAiICsgY29uc2VudERldGFpbHMpOwogICAgCiAgICBpZiAoY29uc2VudERldGFpbHMgIT0gbnVsbCkgewoJCXZhciBwZXJtaXNzaW9uc0pzb25SZXNwb25zZTsKCQl2YXIganNvblJlc3BvbnNlID0gSlNPTi5wYXJzZShjb25zZW50RGV0YWlscy5nZXRFbnRpdHkoKSk7CgkJdmFyIGRhdGFKc29uUmVzcG9uc2UgPSBqc29uUmVzcG9uc2UuRGF0YTsKCQlpZiAoZGF0YUpzb25SZXNwb25zZSAhPSBudWxsKSB7CgkJCWxvZ2dlci5tZXNzYWdlKCJbREVCVUddIFBlcm1pc3Npb25zOiAiICsgZGF0YUpzb25SZXNwb25zZS5QZXJtaXNzaW9ucyk7CgkJCXBlcm1pc3Npb25zSnNvblJlc3BvbnNlID0gZGF0YUpzb25SZXNwb25zZS5QZXJtaXNzaW9uczsKCQkJCgkJCXZhciBpOwoJCQlmb3IgKGkgPSAwOyBpIDwgcGVybWlzc2lvbnNKc29uUmVzcG9uc2UubGVuZ3RoOyBpKyspIHsKCQkJCXZhciByZXN1bHQgPSBwZXJtaXNzaW9uc0pzb25SZXNwb25zZVtpXTsKCQkJCWxvZ2dlci5tZXNzYWdlKCJbREVCVUddIHJlc3VsdDogIiArIHJlc3VsdCk7CgkJCQkKCQkJCWlmIChyZXN1bHQuZXF1YWxzSWdub3JlQ2FzZShjdXJyZW50UGVybWlzc2lvbikpewoJCQkJCWxvZ2dlci5tZXNzYWdlKCJbREVCVUddIEF1dGhvcml6YXRpb24gU3VjY2VlZGVkIik7CgkJCQkJLy9yZXNwb25zZUF0dHJpYnV0ZXMucHV0KCJjb25zZW50RGV0YWlscyIsIFtjb25zZW50RGV0YWlsc10pOwoJCQkJCWF1dGhvcml6ZWQgPSB0cnVlOwoJCQkJfQoJCQl9CgkJfQogICAgfSBlbHNlIHsKICAgICAgICBsb2dnZXIubWVzc2FnZSgiQXV0aG9yaXphdGlvbiBGYWlsZWQiKTsKICAgICAgICBhdXRob3JpemVkID0gZmFsc2U7CiAgICB9Cgp9IGVsc2UgewogICAgbG9nZ2VyLm1lc3NhZ2UoIlJlcXVpcmVkIHBhcmFtZXRlcnMgbm90IGZvdW5kLiBBdXRob3JpemF0aW9uIEZhaWxlZC4iKTsKICAgIGF1dGhvcml6ZWQgPSBmYWxzZTsKfQoKLyoqCiAqIFVzZSB0aGUgaW50ZW50SWQncyB2YWx1ZSB0byBsb29rdXAgdGhlIGNvbnNlbnQgZGV0YWlscyBpbiBJRE0uCiAqCiAqIEByZXR1cm5zIHsqfSBUaGUgdXNlcidzIGNvbnNlbnQgZGV0YWlscyBmcm9tIElETS4KICovCmZ1bmN0aW9uIGdldENvbnNlbnREZXRhaWxzRnJvbUlETShpbnRlbnRJZCkgewogCiAgICB2YXIgcmVxdWVzdCA9IG5ldyBvcmcuZm9yZ2Vyb2NrLmh0dHAucHJvdG9jb2wuUmVxdWVzdCgpOwogICAgcmVxdWVzdC5zZXRVcmkoImh0dHBzOi8vb3BlbmlkbS5wc2QyYWNjZWxlcmF0b3JzLmZyaWRhbS5hZWV0LWZvcmdlcm9jay5jb20vb3BlbmlkbS9tYW5hZ2VkL09CQWNjb3VudEFjY2Vzc0ludGVudC8iICsgaW50ZW50SWQpOwogICAgcmVxdWVzdC5nZXRIZWFkZXJzKCkuYWRkKCdYLU9wZW5JRE0tVXNlcm5hbWUnLCAnb3BlbmlkbS1hZG1pbicpOwoJcmVxdWVzdC5nZXRIZWFkZXJzKCkuYWRkKCdYLU9wZW5JRE0tUGFzc3dvcmQnLCAnb3BlbmlkbS1hZG1pbicpOwogIAlyZXF1ZXN0LnNldE1ldGhvZCgiR0VUIik7CgogICAgdmFyIHJlc3BvbnNlID0gaHR0cENsaWVudC5zZW5kKHJlcXVlc3QpLmdldCgpOwogICAgbG9nUmVzcG9uc2UocmVzcG9uc2UpOwoKCXJldHVybiByZXNwb25zZTsKfQoKLyoqCiAqIFJldHJpZXZlIGFuZCB2YWxpZGF0ZSB0aGUgdmFyaWFibGVzIHJlcXVpcmVkIHRvIG1ha2UgdGhlIGV4dGVybmFsIEhUVFAgY2FsbHMuCiAqCiAqIEByZXR1cm5zIHtib29sZWFufSBXaWxsIGJlIHRydWUgaWYgdmFsaWRhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICovCmZ1bmN0aW9uIHZhbGlkYXRlQW5kSW5pdGlhbGl6ZVBhcmFtZXRlcnMoKSB7CiAgICAvL1RNUCAtIHRvIGJlIHJlcGxhY2VkCgkvLyB0aGUgaW50ZW50SWQgYW5kIGN1cnJlbnRQZXJtaXNzaW9uIHNob3VsZCBiZSBnZXQgZHluYW1pY2FsbHkuLi4KCWludGVudElkID0gIjVjZWNiNGNhLTlhYTctNGNkOS05YTdjLTlhYmM2NGI0ZGUzNiI7CgljdXJyZW50UGVybWlzc2lvbiA9ICJSZWFkQmFsYW5jZXMiOwoJCiAgICBsb2dnZXIubWVzc2FnZSgiW0RFQlVHXSBJbnB1dCBJbnRlbnRJZDogIiArIGludGVudElkKTsKCWxvZ2dlci5tZXNzYWdlKCJbREVCVUddIElucHV0IEN1cnJlbnRQZXJtaXNzaW9uIFJlcXVlc3RlZDogIiArIGN1cnJlbnRQZXJtaXNzaW9uKTsKCiAgICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gbG9nUmVzcG9uc2UocmVzcG9uc2UpIHsKICAgIGxvZ2dlci5tZXNzYWdlKCJVc2VyIFJFU1QgQ2FsbC4gU3RhdHVzOiAiICsgcmVzcG9uc2UuZ2V0U3RhdHVzKCkgKyAiLCBCb2R5OiAiICsgcmVzcG9uc2UuZ2V0RW50aXR5KCkpOwp9",
    "default" : false,
    "language" : "JAVASCRIPT",
    "context" : "POLICY_CONDITION",
    "createdBy" : "null",
    "creationDate" : 0,
    "lastModifiedBy" : "null",
    "lastModifiedDate" : 0
  }
}